#!/usr/bin/env

set -e

# evaluate the environment variables
eval CH=\$${1}_CONNECTION_HOST
eval CU=\$${1}_CONNECTION_USER
eval CP=\$${1}_CONNECTION_PASSWORD
eval CD=\$${1}_CONNECTION_DB
eval CPO=\$${1}_CONNECTION_POOL
eval CENSUS_D=\$${1}_CENSUS_DATA
eval VOTES_D=\$${1}_VOTES_DATA
eval INFO_D=\$${1}_INFO_DATA
eval DEMO_C=\$${1}_DEMOGRAPHIC_CACHE

convox login ${CONVOX_GRID_HOST} -p ${CONVOX_API_KEY}
convox switch ${1}
convox env set CONNECTION_HOST=${CH} CONNECTION_USER=${CU} CONNECTION_PASSWORD=${CP} CONNECTION_DB=${CD} CONNECTION_POOL=${CPO} CENSUS_DATA=${CENSUS_D} VOTES_DATA=${VOTES_D} INFO_DATA=${INFO_D} DEMOGRAPHIC_CACHE=${DEMO_C}
convox deploy
